generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  createdAt            DateTime          @default(now())

  id                   Bytes             @id
  username             String            @unique

  identityKey          Bytes             @unique
  encryptionKey        Bytes             @unique
  encryptedKeys        EncryptedKeys?

  friendRequests       FriendRequest[]   @relation(name: "recipient")
  sentFriendRequests   FriendRequest[]   @relation(name: "sender")

  followedBy           User[]            @relation(name: "friends")
  followers            User[]            @relation(name: "friends")
}

model EncryptedKeys {
  userId            Bytes   @id
  user              User    @relation(fields: [userId], references: [id])

  passwordSalt      Bytes

  identityKey       Bytes
  identityKeyIv     Bytes

  encryptionKey     Bytes
  encryptionKeyIv   Bytes
}

model FriendRequest {
  senderId      Bytes
  sender        User    @relation(name: "sender", fields: [senderId], references: [id])

  recipientId   Bytes
  recipient     User    @relation(name: "recipient", fields: [recipientId], references: [id])

  @@id([senderId, recipientId])
}